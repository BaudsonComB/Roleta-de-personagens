<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Roletas de Personagem</title>
<style>
  /* Reset básico */
  * {
    box-sizing: border-box;
  }
  
  body {
    margin: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #2b2b2b; /* fundo cinza escuro */
    color: #f3d1c1;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }
  
  header {
    background-color: #a60020; /* carmesim forte */
    padding: 20px 30px;
    text-align: center;
    font-weight: 700;
    font-size: 24px;
    color: #fff3f0;
    box-shadow: 0 2px 6px rgba(166,0,32,.8);
  }
  
  main {
    flex: 1;
    padding: 20px 30px;
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    justify-content: center;
  }

  .roleta-container {
    background: #441212; /* vermelho escuro bem forte */
    border: 3px solid #a60020;
    border-radius: 12px;
    padding: 15px 20px 25px;
    width: 320px;
    box-shadow: 0 0 18px #a60020aa;
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  h2 {
    margin: 0 0 12px;
    font-weight: 700;
    color: #ff9e8c;
    user-select: none;
  }

  textarea {
    width: 100%;
    height: 70px;
    resize: vertical;
    background: #5e1919;
    border: 1px solid #a60020;
    color: #ffe6d1;
    padding: 10px;
    border-radius: 8px;
    font-size: 14px;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin-bottom: 15px;
    transition: border-color 0.3s;
  }
  textarea:focus {
    border-color: #ff5c5c;
    outline: none;
  }

  canvas {
    border-radius: 50%;
    border: 3px solid #a60020;
    box-shadow: inset 0 0 16px #ff6f6f80;
    background-color: #5e1919;
    display: block;
    margin-bottom: 12px;
  }

  .checkbox-container {
    width: 100%;
    display: flex;
    align-items: center;
    margin-bottom: 12px;
    user-select: none;
  }

  .checkbox-container input[type="checkbox"] {
    margin-right: 8px;
    width: 18px;
    height: 18px;
    cursor: pointer;
    filter: drop-shadow(0 0 1px black);
  }

  button {
    background-color: #a60020;
    border: none;
    padding: 11px 25px;
    color: #fff3f0;
    font-weight: 700;
    border-radius: 10px;
    cursor: pointer;
    font-size: 16px;
    transition: background-color 0.25s ease;
    user-select: none;
  }
  button:hover {
    background-color: #ff4a4a;
  }
  button:active {
    transform: scale(0.96);
  }

  .result {
    margin-top: 15px;
    font-weight: 700;
    font-size: 18px;
    color: #ffbbb1;
    min-height: 24px;
    text-align: center;
    user-select: text;
  }

  /* Seta preta estilizada na borda direita da roleta */
  .seta-indicadora {
    position: absolute;
    width: 0;
    height: 0;
    border-top: 22px solid transparent;
    border-bottom: 22px solid transparent;
    border-right: 34px solid black;
    filter: drop-shadow(2px 0 2px white);
    top: 50%;
    right: -1px;
    transform: translateY(-50%);
    pointer-events: none;
    z-index: 10;
    transition: transform 0.5s ease-out;
  }

  /* Responsividade */
  @media (max-width: 700px) {
    main {
      justify-content: center;
      padding: 15px 10px;
    }
    .roleta-container {
      width: 100%;
      max-width: 360px;
      margin-bottom: 25px;
      padding: 15px 15px 25px;
    }
    .seta-indicadora {
      right: -30px;
      border-top: 18px solid transparent;
      border-bottom: 18px solid transparent;
      border-right: 28px solid black;
    }
  }
</style>
</head>
<body>

<header>Roletas de Personagem</header>

<main id="roletas"></main>

<script>
  // Dados iniciais para as roletas
  const dados = [
    {
      titulo: 'Roleta de lado',
      opcoes: [
        'Pirata', 'Marinheiro', 'Revolucionário', 'Caçador de Recompensas', 'Civil', 'Tenryuubito',
        'Cipher Pol', 'Ex-marinheiro', 'Yonkou', 'Shichibukai', 'Almirante', 'Ex-Almirante',
        'Samurai', 'Capitão pirata', 'Imperador/Imperatriz'
      ]
    },
    {
      titulo: 'Poderes',
      opcoes: ['Akuma no Mi', 'Haki', 'Magia', 'Haki + Magia', 'Haki + Akuma no Mi', 'Akuma no Mi + Magia', 'Todos']
    },
    {
      titulo: 'Classe',
      opcoes: [
        'Espadachim', 'Porradeiro', 'Artilheiro', 'Carpinteiro', 'Navegador', 'Médico',
        'Cozinheiro', 'Cartógrafo', 'Arqueólogo', 'Músico', 'Cartomante', 'Assassino',
        'Ladrão', 'Engenheiro', 'Diplomata'
      ]
    },
    {
      titulo: 'Akuma no Mi',
      opcoes: [
        'Hito Hito no Mi: Modelo Nika',
        'Bara Bara no Mi',
        'Sube Sube no Mi',
        'Bomu Bomu no Mi',
        'Suna Suna no Mi',
        'Magu Magu no Mi',
        'Goro Goro no Mi',
        'Yami Yami no Mi',
        'Mera Mera no Mi',
        'Doku Doku no Mi',
        'Hie Hie no Mi',
        'Tori Tori no Mi: Modelo Fênix',
        'Nikyu Nikyu no Mi',
        'Noro Noro no Mi',
        'Gomu Gomu no Mi',
        'Ito Ito no Mi',
        'Kilo Kilo no Mi',
        'Mochi Mochi no Mi',
        'Awa Awa no Mi',
        'Baku Baku no Mi',
        'Ushi Ushi no Mi: Modelo Búfalo',
        'Ryu Ryu no Mi: Modelo Dragão',
        'Zoan Ancestral',
        'Inu Inu no Mi: Modelo Lobo',
        'Inu Inu no Mi: Modelo Kyubi no Kitsune',
        'Hebi Hebi no Mi: Modelo Yamata no Orochi',
        'Tatsu Tatsu no Mi: Modelo Dragão Asiático',
        'Ryu Ryu no Mi: Modelo Spinosaurus',
        'Ryu Ryu no Mi: Modelo Pteranodon',
        'Uma Uma no Mi: Modelo Cavalo',
        'Hito Hito no Mi',
        'Mogu Mogu no Mi',
        'Suke Suke no Mi',
        'Yuki Yuki no Mi',
        'Neko Neko no Mi: Modelo Leopardo',
        'Neko Neko no Mi: Modelo Guepardo',
        'Hebi Hebi no Mi: Modelo Cobra',
        'Mera Mera no Mi: Modelo Dragão',
        'Pika Pika no Mi',
        'Kilo Kilo no Mi: Modelo Elefante',
        'Baku Baku no Mi: Modelo Urso',
        'Hie Hie no Mi: Modelo Tigre',
        'Doku Doku no Mi: Modelo Serpente',
        'Gura Gura no Mi',
        'Nika Nika no Mi',
        'Riku Riku no Mi: Modelo Elefante',
        'Hito Hito no Mi: Modelo Antropomórfico',
        'Sabi Sabi no Mi',
        'Toge Toge no Mi',
        'Mera Mera no Mi: Modelo Fênix',
        'Ushi Ushi no Mi: Modelo Bisão',
        'Kuma Kuma no Mi',
        'Soru Soru no Mi',
        'Goe Goe no Mi',
        'Bomu Bomu no Mi: Modelo Bomba',
        'Yuki Yuki no Mi: Modelo Pinguim',
        'Doku Doku no Mi: Modelo Escorpião',
        'Suke Suke no Mi: Modelo Fantasma',
        'Kira Kira no Mi',
        'Mogu Mogu no Mi: Modelo Toupeira',
        'Pika Pika no Mi: Modelo Relâmpago',
        'Awa Awa no Mi: Modelo Bolha',
        'Bari Bari no Mi',
        'Mera Mera no Mi: Modelo Chama Azul',
        'Bomu Bomu no Mi: Modelo C4',
        'Mogu Mogu no Mi: Modelo Toupeira Gigante',
        'Kumo Kumo no Mi: Modelo Aranha',
        'Neko Neko no Mi: Modelo Gato Preto',
        'Baku Baku no Mi: Modelo Porco',
        'Sabi Sabi no Mi: Modelo Ferrugem',
        'Toge Toge no Mi: Modelo Espinhos',
        'Gomu Gomu no Mi: Modelo Borracha',
        'Doku Doku no Mi: Modelo Vírus',
        'Goro Goro no Mi: Modelo Relâmpago',
        'Yami Yami no Mi: Modelo Escuridão',
        'Hie Hie no Mi: Modelo Gelo',
        'Bomu Bomu no Mi: Modelo Mina',
        'Soru Soru no Mi: Modelo Alma',
        'Mera Mera no Mi: Modelo Fogo',
        'Nikyu Nikyu no Mi: Modelo Patas',
        'Kilo Kilo no Mi: Modelo Peso',
        'Mochi Mochi no Mi: Modelo Massinha',
        'Gura Gura no Mi: Modelo Terremoto',
        'Ito Ito no Mi: Modelo Fio',
        'Nika Nika no Mi: Modelo Sol',
        'Ryu Ryu no Mi: Modelo Dragão Ancestral',
        'Zoan Ancestral: Modelo Tigre',
        'Hebi Hebi no Mi: Modelo Dragão',
        'Tatsu Tatsu no Mi: Modelo Dragão Oriental',
        'Inu Inu no Mi: Modelo Cão',
        'Ushi Ushi no Mi: Modelo Touro',
        'Uma Uma no Mi: Modelo Cavalo Selvagem',
        'Kuma Kuma no Mi: Modelo Urso Polar',
        'Soru Soru no Mi: Modelo Alma Assassina',
        'Bari Bari no Mi: Modelo Armadura',
        'Mera Mera no Mi: Modelo Dragão de Fogo',
        'Pika Pika no Mi: Modelo Luz',
        'Kumo Kumo no Mi: Modelo Nuvem',
        'Toge Toge no Mi: Modelo Cacto',
        'Sabi Sabi no Mi: Modelo Ferrugem Antiga',
        'Yuki Yuki no Mi: Modelo Neve',
        'Doku Doku no Mi: Modelo Veneno',
        'Mogu Mogu no Mi: Modelo Toupeira Normal',
        'Kira Kira no Mi: Modelo Cristal',
        'Suke Suke no Mi: Modelo Invisibilidade',
        'Awa Awa no Mi: Modelo Bolha Gigante',
        'Bomu Bomu no Mi: Modelo Explosão',
        'Kumo Kumo no Mi: Modelo Aranha Gigante',
        'Neko Neko no Mi: Modelo Gato Selvagem',
        'Hito Hito no Mi: Modelo Humanoide',
        'Hebi Hebi no Mi: Modelo Cobra Real',
        'Ryu Ryu no Mi: Modelo Dragão Vermelho',
        'Tatsu Tatsu no Mi: Modelo Dragão Branco',
        'Inu Inu no Mi: Modelo Lobo Cinzento',
        'Ushi Ushi no Mi: Modelo Búfalo Selvagem',
        'Uma Uma no Mi: Modelo Cavalo Marinho',
        'Kuma Kuma no Mi: Modelo Urso Gigante',
        'Soru Soru no Mi: Modelo Espírito',
        'Bari Bari no Mi: Modelo Armadura de Ferro',
        'Mera Mera no Mi: Modelo Fogo Azul',
        'Pika Pika no Mi: Modelo Raio',
        'Kumo Kumo no Mi: Modelo Nuvem Negra',
        'Toge Toge no Mi: Modelo Cacto Espinhoso',
        'Sabi Sabi no Mi: Modelo Ferrugem Venenosa',
        'Yuki Yuki no Mi: Modelo Tempestade de Neve',
        'Doku Doku no Mi: Modelo Veneno Mortal',
        'Mogu Mogu no Mi: Modelo Toupeira Gigante',
        'Kira Kira no Mi: Modelo Diamante',
        'Suke Suke no Mi: Modelo Fantasma Invisível',
        'Awa Awa no Mi: Modelo Bolha de Sabão',
        'Bomu Bomu no Mi: Modelo Explosão',
        'Kumo Kumo no Mi: Modelo Aranha Venenosa',
        'Neko Neko no Mi: Modelo Gato Selvagem',
        'Hito Hito no Mi: Modelo Humano Supremo',
        'Hebi Hebi no Mi: Modelo Dragão Ancestral',
        'Ryu Ryu no Mi: Modelo Dragão Espacial',
        'Tatsu Tatsu no Mi: Modelo Dragão Celestial',
        'Inu Inu no Mi: Modelo Cão Selvagem',
        'Ushi Ushi no Mi: Modelo Touro Selvagem',
        'Uma Uma no Mi: Modelo Cavalo Branco',
        'Kuma Kuma no Mi: Modelo Urso Marrom',
        'Soru Soru no Mi: Modelo Alma Negra',
        'Bari Bari no Mi: Modelo Armadura Poderosa',
        'Mera Mera no Mi: Modelo Fogo Selvagem',
        'Pika Pika no Mi: Modelo Luz Estelar',
        'Kumo Kumo no Mi: Modelo Nuvem de Tempestade',
        'Toge Toge no Mi: Modelo Cacto Gigante',
        'Sabi Sabi no Mi: Modelo Ferrugem Antiga',
        'Yuki Yuki no Mi: Modelo Nevasca',
        'Doku Doku no Mi: Modelo Veneno Extremo',
        'Mogu Mogu no Mi: Modelo Toupeira Veloz',
        'Kira Kira no Mi: Modelo Cristal Radiante',
        'Suke Suke no Mi: Modelo Invisibilidade Total',
        'Awa Awa no Mi: Modelo Bolha Gigante',
        'Bomu Bomu no Mi: Modelo Bomba Final',
        'Kumo Kumo no Mi: Modelo Aranha Sombria',
        'Neko Neko no Mi: Modelo Leopardo Selvagem',
        'Hito Hito no Mi: Modelo Divino',
        'Hebi Hebi no Mi: Modelo Dragão de Ouro',
        'Ryu Ryu no Mi: Modelo Dragão Negro',
        'Tatsu Tatsu no Mi: Modelo Dragão do Trovão',
        'Inu Inu no Mi: Modelo Lobo Branco',
        'Ushi Ushi no Mi: Modelo Búfalo Negro',
        'Uma Uma no Mi: Modelo Cavalo Negro',
        'Kuma Kuma no Mi: Modelo Urso Polar Gigante',
        'Soru Soru no Mi: Modelo Alma Branca',
        'Bari Bari no Mi: Modelo Armadura Final',
        'Mera Mera no Mi: Modelo Fogo Final',
        'Pika Pika no Mi: Modelo Luz Final',
        'Kumo Kumo no Mi: Modelo Nuvem Final',
        'Toge Toge no Mi: Modelo Cacto Final',
        'Sabi Sabi no Mi: Modelo Ferrugem Final',
        'Yuki Yuki no Mi: Modelo Neve Final',
        'Doku Doku no Mi: Modelo Veneno Final',
        'Mogu Mogu no Mi: Modelo Toupeira Final',
        'Kira Kira no Mi: Modelo Cristal Final',
        'Suke Suke no Mi: Modelo Invisibilidade Final',
        'Awa Awa no Mi: Modelo Bolha Final',
        'Bomu Bomu no Mi: Modelo Bomba Final',
        'Kumo Kumo no Mi: Modelo Aranha Final',
        'Neko Neko no Mi: Modelo Gato Final'
      ]
    },
    {
      titulo: 'Hakis',
      opcoes: [
        'Observação',
        'Armamento',
        'Rei',
        'Observação + Armamento',
        'Observação + Rei',
        'Armamento + Rei',
        'Observação + Armamento + Rei'
      ]
    },
    {
      titulo: 'Raça',
      opcoes: [
        'Humano',
        'Lunariano',
        'Homem-Peixe',
        'Tritão',
        'Gigante',
        'Mink',
        'Skypiean',
        'Anão',
        'Ciborgue',
        'Semi-ciborgue',
        'Ciborgue avançado',
        'Metamorfose',
        'Zoan',
        'Tritão Zoan',
        'Dragão',
        'Metamórfico',
        'Fada',
        'Demônio',
        'Outro'
      ]
    }
  ];

  const opcoesUsadas = dados.map(() => new Set());

  // Cria roleta, textarea, checkbox, botão e resultado
  function criarRoleta(item, index) {
    const container = document.createElement('section');
    container.className = 'roleta-container';

    // Título
    const titulo = document.createElement('h2');
    titulo.textContent = item.titulo;
    container.appendChild(titulo);

    // Textarea para editar opções
    const textarea = document.createElement('textarea');
    textarea.value = item.opcoes.join('\n');
    textarea.rows = 4;
    textarea.spellcheck = false;
    textarea.addEventListener('input', () => {
      item.opcoes = textarea.value
        .split('\n')
        .map(s => s.trim())
        .filter(s => s.length > 0);
      opcoesUsadas[index].clear();
      desenharRoleta(index, item.opcoes, 0);
      document.getElementById('resultado-' + index).textContent = '';
    });
    container.appendChild(textarea);

    // Canvas da roleta
    const canvas = document.createElement('canvas');
    canvas.width = 280;
    canvas.height = 280;
    canvas.id = 'canvas-' + index;
    container.appendChild(canvas);

    // Seta indicadora preta fixa na borda direita
    const seta = document.createElement('div');
    seta.className = 'seta-indicadora';
    container.appendChild(seta);

    // Checkbox para excluir opções já sorteadas
    const checkboxDiv = document.createElement('label');
    checkboxDiv.className = 'checkbox-container';
    const checkbox = document.createElement('input');
    checkbox.type = 'checkbox';
    checkbox.id = 'excluir-' + index;
    checkboxDiv.appendChild(checkbox);
    checkboxDiv.appendChild(document.createTextNode('Excluir opções já sorteadas'));
    container.appendChild(checkboxDiv);

    // Botão girar
    const btn = document.createElement('button');
    btn.textContent = 'Girar';
    btn.onclick = () => girarRoleta(index);
    container.appendChild(btn);

    // Resultado do sorteio
    const resultado = document.createElement('div');
    resultado.className = 'result';
    resultado.id = 'resultado-' + index;
    container.appendChild(resultado);

    document.getElementById('roletas').appendChild(container);

    // Desenha roleta inicialmente
    desenharRoleta(index, item.opcoes, 0);
  }

  // Função para desenhar a roleta no canvas
  function desenharRoleta(index, opcoes, angulo) {
    const canvas = document.getElementById('canvas-' + index);
    if (!canvas) return;
    const ctx = canvas.getContext('2d');
    const cx = canvas.width / 2;
    const cy = canvas.height / 2;
    const raio = Math.min(cx, cy) - 25;

    ctx.clearRect(0, 0, canvas.width, canvas.height);

    const n = opcoes.length;
    if (n === 0) return;

    const anguloPorOpcao = (2 * Math.PI) / n;

    ctx.save();
    ctx.translate(cx, cy);
    ctx.rotate(angulo);
    ctx.translate(-cx, -cy);

    for (let i = 0; i < n; i++) {
      ctx.beginPath();
      ctx.moveTo(cx, cy);
      ctx.fillStyle = i % 2 === 0 ? '#cc3333' : '#991111';
      ctx.strokeStyle = '#550000';
      ctx.lineWidth = 2;
      ctx.arc(cx, cy, raio, i * anguloPorOpcao, (i + 1) * anguloPorOpcao);
      ctx.lineTo(cx, cy);
      ctx.fill();
      ctx.stroke();

      // Texto no meio da fatia
      ctx.save();
      const meioAngulo = (i + 0.5) * anguloPorOpcao;
      ctx.translate(cx, cy);
      ctx.rotate(meioAngulo);
      ctx.fillStyle = '#fff3f0';
      ctx.font = '13px Segoe UI';
      ctx.textAlign = 'right';
      ctx.textBaseline = 'middle';
      let texto = opcoes[i];
      if (texto.length > 22) texto = texto.slice(0, 19) + '...';
      ctx.fillText(texto, raio - 10, 0);
      ctx.restore();
    }

    ctx.restore();
  }

  // Controle de animação e estado
  const angulos = dados.map(() => 0);
  const rodando = dados.map(() => false);

  function girarRoleta(index) {
    if (rodando[index]) return;

    const opcoes = dados[index].opcoes;
    if (opcoes.length === 0) {
      alert('Não há opções para essa roleta.');
      return;
    }

    const excluir = document.getElementById('excluir-' + index).checked;
    let opcoesValidas = opcoes.filter(o => !opcoesUsadas[index].has(o));
    if (excluir && opcoesValidas.length === 0) {
      alert('Todas as opções já foram usadas. Desmarque a exclusão ou edite as opções.');
      return;
    }
    if (!excluir) opcoesValidas = opcoes;

    rodando[index] = true;
    const canvas = document.getElementById('canvas-' + index);
    const ctx = canvas.getContext('2d');

    // Escolhe aleatório válido
    const escolhido = opcoesValidas[Math.floor(Math.random() * opcoesValidas.length)];

    // Índice do escolhido
    const indice = opcoes.indexOf(escolhido);
    const n = opcoes.length;
    const anguloPorOpcao = 2 * Math.PI / n;

    // Calcula ângulo de parada (5 voltas + alinhar fatia na seta)
    const anguloParada = 2 * Math.PI * 5 + (2 * Math.PI - (indice + 0.5) * anguloPorOpcao);

    const duracao = 4000;
    const inicio = performance.now();

    function animar(t) {
      const elapsed = t - inicio;
      if (elapsed >= duracao) {
        angulos[index] = anguloParada % (2 * Math.PI);
        desenharRoleta(index, opcoes, angulos[index]);
        rodando[index] = false;
        document.getElementById('resultado-' + index).textContent = escolhido;
        if (excluir) {
          opcoesUsadas[index].add(escolhido);
        }
        return;
      }
      const progresso = elapsed / duracao;
      const ease = 1 - Math.pow(1 - progresso, 3);
      angulos[index] = ease * anguloParada;
      desenharRoleta(index, opcoes, angulos[index]);
      requestAnimationFrame(animar);
    }
    requestAnimationFrame(animar);
  }

  // Criar as roletas ao carregar
  dados.forEach((item, i) => criarRoleta(item, i));
</script>

</body>
</html>
